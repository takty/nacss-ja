{"version":3,"sources":["ja.js"],"names":["window","NS","hasClass","tar","cls","key","substr","startsWith","undefined","dataset","classList","contains","setClass","enabled","val","c","join","add","remove","apply","ts","opts","length","Object","assign","styleKerning","styleDisabled","ignoredTags","doAssignAttribute","doDisableOnSelecting","map","e","toUpperCase","t","kernElement","dict","f","removeKerning","removeEventListener","addEventListener","elm","s","getElementsByTagName","df","document","createDocumentFragment","childNodes","appendChild","parentNode","replaceChild","applyToString","str","ks","getKerning","createFragment","nodeType","includes","tagName","kernTextNode","tn","isHead","isTail","isEnd","textContent","mzs","match","replace","removeHeadWhiteSpaces","removeTailWhiteSpaces","removeWhiteSpacesBetweenZenChars","nt","nextSibling","getComputedStyle","display","innerText","parentNext","p","HTMLElement","pd","isSiblingBlock","pp","n","greedy","isPreviousBlockGreedy","previousSibling","isBlock","trim","nextNodeText","assignAttr","strArray","ret","concat","l","i","c0","c1","a","has","push","k","Number","isInteger","createTextNode","slice","createElement","style","Set","addPairs","cs0","cs1","addSolos","head","h","applyKerning","applyKerningToString","sortProperNouns","styleSegment","properNouns","segmentElement","removeSegment","sty","className","ws","getSegment","pns","sort","b","segmentTextNode","IW","split","AW","AI1","PRE_KANJI","PRE_NUM","createCharTypeArray","Array","fill","weightByCharTypes","strA","weightByPhrases","weightByPhraseAndType","CLS_ALL","CLS_WO_KANJI","CLS_ORIG","CHAR_PATTERNS","getCharType","test","PAIRS","II","KK","HH","NN","OO","TT","HI","NH","NK","NI","ON","NO","t0","t1","phrases","factor","offset","ph","phA","phL","bgn","idx0","indexOfArray","idx1","prevCts","nextCts","prevW","nextW","tsL","array","searchElement","fromIndex","j","temp","idx","appendPhrase","isOriginalCharPhrase","isOrig","end","applySegmenter","applySegmenterToString","g1","d","g2"],"mappings":"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","file":"ja.min.js","sourcesContent":["/**\n * Japanese Text\n *\n * @author Takuto Yanagida\n * @version 2021-12-26\n */\n\n'use strict';\n\nwindow['NACSS']       = window['NACSS']       || {};\nwindow['NACSS']['ja'] = window['NACSS']['ja'] || {};\n\n\n((NS) => {\n\n\t/**\n\t * Style Class Utilities\n\t *\n\t * @author Takuto Yanagida\n\t * @version 2021-11-11\n\t */\n\t\n\tfunction hasClass(tar, cls) {\n\t\tconst key = cls.substr(1);\n\t\tif (cls.startsWith(':')) {\n\t\t\treturn tar.dataset[key] !== undefined;\n\t\t} else {\n\t\t\treturn tar.classList.contains(key);\n\t\t}\n\t}\n\t\n\tfunction setClass(tar, cls, enabled = true, val = '') {\n\t\tconst key = cls.substr(1);\n\t\tif (cls.startsWith(':')) {\n\t\t\tif (enabled) {\n\t\t\t\ttar.dataset[key] = val;\n\t\t\t} else {\n\t\t\t\tdelete tar.dataset[key];\n\t\t\t}\n\t\t} else {\n\t\t\tconst c = [key, val].join('-');\n\t\t\tif (enabled) {\n\t\t\t\ttar.classList.add(c);\n\t\t\t} else {\n\t\t\t\ttar.classList.remove(c);\n\t\t\t}\n\t\t}\n\t}\n\t\n\tfunction getSelector(cls) {\n\t\tif (cls.startsWith(':')) {\n\t\t\treturn `*[data-${cls.substr(1).replace(/([A-Z])/g, c => '-' + c.charAt(0).toLowerCase())}]`;\n\t\t} else {\n\t\t\treturn `*${cls}`;\n\t\t}\n\t}\n\t\n\t{\n\t\t/**\n\t\t * Kerning\n\t\t *\n\t\t * @author Takuto Yanagida\n\t\t * @version 2023-03-30\n\t\t */\n\t\t\n\t\tfunction apply(ts, opts = {}) {\n\t\t\tif (ts.length === 0) return;\n\t\t\n\t\t\topts = Object.assign({\n\t\t\t\tstyleKerning        : ':ncKern',\n\t\t\t\tstyleDisabled       : ':ncNoKerning',\n\t\t\t\tignoredTags         : ['PRE'],\n\t\t\t\tdoAssignAttribute   : true,\n\t\t\t\tdoDisableOnSelecting: true,\n\t\t\t}, opts);\n\t\t\topts.ignoredTags = opts.ignoredTags.map(e => e.toUpperCase());\n\t\t\n\t\t\tfor (const t of ts) {\n\t\t\t\tkernElement(t, dict, opts);\n\t\t\t\tif (opts['doAssignAttribute'] && opts['doDisableOnSelecting']) {\n\t\t\t\t\tconst f = () => {\n\t\t\t\t\t\tremoveKerning(t, opts);\n\t\t\t\t\t\tt.removeEventListener('selectstart', f);\n\t\t\t\t\t};\n\t\t\t\t\tt.addEventListener('selectstart', f);\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t\t\n\t\tfunction removeKerning(elm, opts) {\n\t\t\tfor (const s of [...elm.getElementsByTagName('span')]) {\n\t\t\t\tif (hasClass(s, opts.styleKerning)) {\n\t\t\t\t\tconst df = document.createDocumentFragment();\n\t\t\t\t\tfor (const c of [...s.childNodes]) {\n\t\t\t\t\t\tdf.appendChild(c);\n\t\t\t\t\t}\n\t\t\t\t\ts.parentNode.replaceChild(df, s);\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t\t\n\t\tfunction applyToString(str, opts = {}) {\n\t\t\topts = Object.assign({\n\t\t\t\tstyleKerning     : ':ncKern',\n\t\t\t\tstyleDisabled    : ':ncNoKerning',\n\t\t\t\tdoAssignAttribute: true,\n\t\t\t}, opts);\n\t\t\n\t\t\tconst ks = getKerning(str, dict, false, opts.doAssignAttribute);\n\t\t\tif (ks.length) {\n\t\t\t\treturn createFragment(str, ks, opts);\n\t\t\t}\n\t\t\treturn null;\n\t\t}\n\t\t\n\t\t\n\t\t// -----------------------------------------------------------------------------\n\t\t\n\t\t\n\t\tfunction kernElement(elm, dict, opts) {\n\t\t\tfor (const c of [...elm.childNodes]) {\n\t\t\t\tif (c.nodeType === 1) {  // ELEMENT_NODE\n\t\t\t\t\tif (!hasClass(c, opts.styleDisabled) && !opts.ignoredTags.includes(c.tagName)) {\n\t\t\t\t\t\tkernElement(c, dict, opts);\n\t\t\t\t\t}\n\t\t\t\t} else if (c.nodeType === 3) {  // TEXT_NODE\n\t\t\t\t\tkernTextNode(c, dict, opts);\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t\t\n\t\tfunction kernTextNode(tn, dict, opts) {\n\t\t\tconst [isHead, isTail] = isEnd(tn);\n\t\t\n\t\t\tlet str = tn.textContent;\n\t\t\tif (isHead) str = removeHeadWhiteSpaces(str);\n\t\t\tif (isTail) str = removeTailWhiteSpaces(str);\n\t\t\tstr = removeWhiteSpacesBetweenZenChars(str);\n\t\t\n\t\t\tlet nt = '';\n\t\t\tif (tn.nextSibling && tn.nextSibling.nodeType === 1 && getComputedStyle(tn.nextSibling).display === 'inline') {\n\t\t\t\tnt = tn.nextSibling.innerText;\n\t\t\t}\n\t\t\tif (!tn.nextSibling && tn.parentNode.nextSibling) {\n\t\t\t\tconst parentNext = tn.parentNode.nextSibling;\n\t\t\t\tif (parentNext.nodeType === 1) {  // ELEMENT_NODE\n\t\t\t\t\tconst pnd = getComputedStyle(parentNext).display;\n\t\t\t\t\tif (pnd.includes('inline')) {\n\t\t\t\t\t\tnt = parentNext.innerText;\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t\tif (parentNext.nodeType === 3) {  // TEXT_NODE\n\t\t\t\t\tnt = parentNext.textContent;\n\t\t\t\t}\n\t\t\t}\n\t\t\n\t\t\tconst ks = getKerning(str, dict, isHead, nt, opts.doAssignAttribute);\n\t\t\tif (ks.length) {\n\t\t\t\tconst f = createFragment(str, ks, opts);\n\t\t\t\ttn.parentNode.replaceChild(f, tn);\n\t\t\t}\n\t\t}\n\t\t\n\t\tfunction isEnd(tn) {\n\t\t\tconst p = tn.parentNode;\n\t\t\tif (!(p instanceof HTMLElement)) return [false, false];\n\t\t\tconst pd = getComputedStyle(p).display;\n\t\t\tif (!pd.includes('inline')) {  // Block\n\t\t\t\treturn isSiblingBlock(tn);\n\t\t\t}\n\t\t\tif (pd === 'inline-block') {  // Inline block\n\t\t\t\tif (p.childNodes.length !== 1) {  // The parent has multiple nodes.\n\t\t\t\t\treturn isSiblingBlock(tn);\n\t\t\t\t}\n\t\t\t\tconst pp = p.parentNode;\n\t\t\t\tif (pp) {\n\t\t\t\t\tconst ppd = getComputedStyle(pp).display;\n\t\t\t\t\tif (!ppd.includes('inline')) {\n\t\t\t\t\t\treturn isSiblingBlock(p, true);\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\t\t\treturn [false, false];  // Not inline block\n\t\t}\n\t\t\n\t\tfunction isSiblingBlock(n, greedy = false) {\n\t\t\treturn [greedy ? isPreviousBlockGreedy(n.previousSibling) : isBlock(n.previousSibling), isBlock(n.nextSibling)];\n\t\t}\n\t\t\n\t\tfunction isBlock(n) {\n\t\t\tif (n === null) return true;\n\t\t\tif (!(n instanceof HTMLElement)) return false;\n\t\t\tif (n.tagName === 'BR') return true;\n\t\t\treturn !getComputedStyle(n).display.includes('inline');\n\t\t}\n\t\t\n\t\tfunction isPreviousBlockGreedy(n) {\n\t\t\twhile (true) {\n\t\t\t\tif (n === null) return true;\n\t\t\t\tif (n.nodeType === 1) {\n\t\t\t\t\tif (n.tagName === 'BR') return true;\n\t\t\t\t\treturn !getComputedStyle(n).display.includes('inline');\n\t\t\t\t}\n\t\t\t\tif (n.nodeType === 3) {\n\t\t\t\t\tif (!n.textContent.trim()) return true;\n\t\t\t\t}\n\t\t\t\tn = n.previousSibling;\n\t\t\t}\n\t\t}\n\t\t\n\t\t\n\t\t// -----------------------------------------------------------------------------\n\t\t\n\t\t\n\t\tfunction getKerning(str, dict, isHead, nextNodeText, assignAttr) {\n\t\t\tlet strArray = [...str];\n\t\t\tconst ret = [];\n\t\t\n\t\t\tif (nextNodeText.length) {\n\t\t\t\tstrArray = strArray.concat([...nextNodeText]);\n\t\t\t}\n\t\t\tlet l = 0;\n\t\t\n\t\t\tfor (let i = 0; i < strArray.length; i += 1) {\n\t\t\t\tconst c0 = strArray[i];\n\t\t\t\tconst c1 = strArray[i + 1];\n\t\t\n\t\t\t\tlet a = '';\n\t\t\t\tif (c0 !== '' && c1 !== '' && dict.has(c0 + c1)) {\n\t\t\t\t\ta = assignAttr ? 's' : 'letter-spacing:-0.4em;';\n\t\t\t\t}\n\t\t\t\tif (i === 0 && isHead && c0 !== '' && dict.has(c0)) {\n\t\t\t\t\ta += assignAttr ? 'h' : 'margin-left:-0.4em';\n\t\t\t\t}\n\t\t\t\tif (a.length) {\n\t\t\t\t\tif (l) {\n\t\t\t\t\t\tret.push(l);\n\t\t\t\t\t\tl = 0;\n\t\t\t\t\t}\n\t\t\t\t\tret.push(a);\n\t\t\t\t} else {\n\t\t\t\t\tl += 1;\n\t\t\t\t}\n\t\t\t}\n\t\t\tif (ret.length && l) ret.push(l);\n\t\t\treturn ret;\n\t\t}\n\t\t\n\t\tfunction createFragment(str, ks, opts) {\n\t\t\tconst strArray = [...str];\n\t\t\tconst f = document.createDocumentFragment();\n\t\t\tlet i = 0;\n\t\t\tfor (const k of ks) {\n\t\t\t\tif (Number.isInteger(k)) {\n\t\t\t\t\tconst n = document.createTextNode(strArray.slice(i, i + k).join(''));\n\t\t\t\t\tf.appendChild(n);\n\t\t\t\t\ti += k;\n\t\t\t\t} else {\n\t\t\t\t\tconst n = document.createElement('span');\n\t\t\t\t\tn.appendChild(document.createTextNode(strArray.slice(i, i + 1).join('')));\n\t\t\t\t\tif (k.length <= 2) {\n\t\t\t\t\t\tsetClass(n, opts.styleKerning, true, k);\n\t\t\t\t\t} else {\n\t\t\t\t\t\tn.style = k;\n\t\t\t\t\t}\n\t\t\t\t\tf.appendChild(n);\n\t\t\t\t\ti += 1;\n\t\t\t\t}\n\t\t\t}\n\t\t\treturn f;\n\t\t}\n\t\t\n\t\t\n\t\t// -----------------------------------------------------------------------------\n\t\t\n\t\t\n\t\tconst dict = new Set();\n\t\t{\n\t\t\taddPairs(dict, '、，。．・｜：　', '「『（［｛〈《【〔');\n\t\t\taddPairs(dict, '」』）］｝〉》】〕', '、，。．・｜：,.');\n\t\t\taddPairs(dict, '」』）］｝〉》】〕', '「『（［｛〈《【〔');\n\t\t\taddPairs(dict, '「『（［｛〈《【〔', '「『（［｛〈《【〔');\n\t\t\taddPairs(dict, '」』）］｝〉》】〕', '」』）］｝〉》】〕');\n\t\t\taddSolos(dict, '「『（［｛〈《【〔');\n\t\t\n\t\t\tfunction addPairs(dict, cs0, cs1) {\n\t\t\t\tfor (const c0 of cs0) {\n\t\t\t\t\tfor (const c1 of cs1) {\n\t\t\t\t\t\tdict.add(c0 + c1);\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\t\t\n\t\t\tfunction addSolos(dict, head) {\n\t\t\t\tfor (const h of head) {\n\t\t\t\t\tdict.add(h);\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t\t\n\t\tNS.applyKerning         = apply;\n\t\tNS.applyKerningToString = applyToString;\n\t}\n\t{\n\t\t/**\n\t\t * Segmenter\n\t\t *\n\t\t * @author Takuto Yanagida\n\t\t * @version 2022-05-27\n\t\t */\n\t\t\n\t\tfunction apply(ts, opts = {}) {\n\t\t\tif (ts.length === 0) return;\n\t\t\n\t\t\topts = Object.assign({\n\t\t\t\tstyleSegment        : '',\n\t\t\t\tstyleDisabled       : ':ncNoSegmentation',\n\t\t\t\tdoDisableOnSelecting: true,\n\t\t\t\tproperNouns         : [],\n\t\t\t}, opts);\n\t\t\tsortProperNouns(opts);\n\t\t\n\t\t\tfor (const t of ts) {\n\t\t\t\tsegmentElement(t, opts);\n\t\t\t\tif (opts['doDisableOnSelecting']) {\n\t\t\t\t\tconst f = () => {\n\t\t\t\t\t\tremoveSegment(t, opts);\n\t\t\t\t\t\tt.removeEventListener('selectstart', f);\n\t\t\t\t\t};\n\t\t\t\t\tt.addEventListener('selectstart', f);\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t\t\n\t\tfunction removeSegment(elm, opts) {\n\t\t\tconst sty = opts.styleSegment;\n\t\t\tfor (const s of [...elm.getElementsByTagName('span')]) {\n\t\t\t\tif ((sty.length === 0 && s.className === '') || hasClass(s, sty)) {\n\t\t\t\t\tconst df = document.createDocumentFragment();\n\t\t\t\t\tfor (const c of [...s.childNodes]) {\n\t\t\t\t\t\tdf.appendChild(c);\n\t\t\t\t\t}\n\t\t\t\t\ts.parentNode.replaceChild(df, s);\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t\t\n\t\tfunction applyToString(str, opts = {}) {\n\t\t\topts = Object.assign({\n\t\t\t\tstyleSegment : '',\n\t\t\t\tstyleDisabled: ':ncNoSegmentation',\n\t\t\t\tproperNouns  : [],\n\t\t\t}, opts);\n\t\t\tsortProperNouns(opts);\n\t\t\n\t\t\tconst [ts, ws] = getSegment(str, opts.properNouns);\n\t\t\treturn createFragment(str, ts, ws, opts);\n\t\t}\n\t\t\n\t\tfunction sortProperNouns(opts) {\n\t\t\tconst pns = opts['properNouns'].map(e => [...e]);\n\t\t\tpns.sort((a, b) => {\n\t\t\t\treturn b.length - a.length;\n\t\t\t});\n\t\t\topts['properNouns'] = pns;\n\t\t}\n\t\t\n\t\t\n\t\t// -------------------------------------------------------------------------\n\t\t\n\t\t\n\t\tfunction segmentElement(elm, opts) {\n\t\t\tfor (const c of [...elm.childNodes]) {\n\t\t\t\tif (c.nodeType === 1) {  // ELEMENT_NODE\n\t\t\t\t\tif (!hasClass(c, opts.styleDisabled)) segmentElement(c, opts);\n\t\t\t\t} else if (c.nodeType === 3) {  // TEXT_NODE\n\t\t\t\t\tsegmentTextNode(c, opts);\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t\t\n\t\tfunction segmentTextNode(tn, opts) {\n\t\t\tlet str = tn.textContent;\n\t\t\tstr = removeWhiteSpacesBetweenZenChars(str);\n\t\t\n\t\t\tconst [ts, ws] = getSegment(str, opts.properNouns);\n\t\t\tconst f = createFragment(str, ts, ws, opts);\n\t\t\ttn.parentNode.replaceChild(f, tn);\n\t\t}\n\t\t\n\t\t\n\t\t// -----------------------------------------------------------------------------\n\t\t\n\t\t\n\t\tconst IW = 'そうはいうものの,そればかりでなく,ありとあらゆる,いずれにしても,かけがえのない,そうしてみると,そうすることで,そうでないなら,そうではあるが,それにくわえて,それはさておき,どっちにしても,とはいうものの,なぜかというと,にもかかわらず,いいかえると,いずれにしろ,いずれにせよ,いってみれば,おもいきった,しかしながら,じつのところ,じつはいうと,そうしないと,そうではなく,そのためには,それどころか,それにしても,それによって,そればかりか,それはそうと,どちらにせよ,どっちにせよ,いろいろな,このように,さまざまな,さもないと,したがって,そういえば,そうしたら,そうすると,そうすれば,そうなると,そうなれば,そのかわり,それなのに,それゆえに,たくまざる,だとしたら,だとすると,だとすれば,ではあるが,というのは,というのも,というより,なぜならば,やすやすと,ようするに,ああいう,ああした,あたかも,あらゆる,あるいは,いかなる,いつかは,いっぱい,いろんな,いわゆる,おおきな,おかしな,おそらく,おなじく,おまけに,かえって,かくして,かわりに,くわえて,ぐんぐん,けれども,こういう,こうして,このため,しかるに,しばらく,すなわち,そういう,そうした,そのうえ,そのくせ,そのため,そもそも,それから,それから,それでは,それでも,それとも,それなら,それには,たいした,たいそう,たくさん,だけども,たとえば,たやすく,ちいさな,ちなみに,というか,どういう,とうてい,ときどき,ところが,どころか,ところで,となると,となれば,とにかく,とはいえ,ともあれ,とりわけ,ないしは,なかでも,なぜなら,なぜなら,なだたる,なにしろ,ならびに,はじめに,はずべき,はなはだ,ひいては,ひょんな,ふとした,ほかには,ほかにも,めっきり,もしくは,もっとも,あまり,あらぬ,ありし,あんな,いただ,いつか,いつも,いわば,および,かかる,かなり,きたる,きっと,けれど,ことに,こんな,さらに,しかし,しかも,じつは,じゃあ,すぐに,すぐに,すると,そこで,そして,そっと,それで,それに,そんな,だから,だけど,ただし,だって,たまに,つぎに,つまり,ですが,とある,どうか,ときに,とくに,とても,とんだ,どんな,なにせ,なのに,ならば,ほんの,まさか,または,むこう,むしろ,もっと,もっと,もっと,ものの,やはり,ゆえに,ようは,よって,ああ,あの,ある,かつ,かの,けど,こう,この,さて,さる,そう,その,だが,ただ,では,でも,どう,どの,なお,なぜ,のに,また,もし,よく,わが'.split(',');\n\t\tconst AW = 'けれども,ところで,において,について,かしら,がてら,くらい,ぐらい,けれど,ってば,ながら,などの,なんぞ,ばかり,ものか,ものの,かい,から,かり,きり,こそ,さえ,しか,ずつ,だけ,だの,たり,つつ,では,ても,でも,とも,なぞ,など,なり,にて,には,ので,のに,のみ,ほど,まで,まま,もん,やら,より,か,が,さ,し,ぜ,ぞ,て,で,と,な,に,ね,の,は,ば,へ,も,や,よ,わ,を'.split(',');\n\t\t\n\t\tconst AI1       = 'がおこな,のような,があり,がおき,ができ,がでて'.split(',');\n\t\tconst PRE_KANJI = 'お,ご'.split(',');\n\t\tconst PRE_NUM   = '第,約'.split(',');\n\t\t\n\t\tfunction getSegment(str, properNouns) {\n\t\t\tconst ts = createCharTypeArray(str);\n\t\t\tconst ws = Array(ts.length).fill(0);\n\t\t\n\t\t\tweightByCharTypes(ts, ws);\n\t\t\n\t\t\tconst strA = [...str];\n\t\t\tif (properNouns.length) weightByPhrases(strA, ws, properNouns, -1);  // Divide\n\t\t\tweightByPhrases(strA, ws, IW, -1);  // Divide\n\t\t\tweightByPhrases(strA, ws, AW, 1);  // Concat\n\t\t\n\t\t\tweightByPhrases(strA, ws, AI1, -1, 1);  // Divide with offset\n\t\t\tweightByPhraseAndType(strA, ts, ws, PRE_KANJI, CLS_ALL,      'H', -1, 2);\n\t\t\tweightByPhraseAndType(strA, ts, ws, PRE_NUM,   CLS_WO_KANJI, 'N',  0, 2);\n\t\t\n\t\t\treturn [ts, ws];\n\t\t}\n\t\t\n\t\t\n\t\t// -----------------------------------------------------------------------------\n\t\t\n\t\t\n\t\tconst CLS_WO_KANJI = 'SETIKNVO';\n\t\tconst CLS_ALL      = 'SETIKHNVO';\n\t\tconst CLS_ORIG     = 'NVO';\n\t\t\n\t\tconst CHAR_PATTERNS = [\n\t\t\t['S', /[「『（［｛〈《【〔〖〘〚＜“]/u],\n\t\t\t['E', /[」』）］｝〉》】〕〗〙〛＞”]/u],\n\t\t\t['T', /[、，。．？！を：・]/u],\n\t\t\t['I', /[ぁ-んゝ]/u],\n\t\t\t['K', /[ァ-ヴーｱ-ﾝﾞｰ]/u],\n\t\t\t['H', /[々〆ヵヶ]|[\\u4E00-\\u9FFF]|[\\u{20000}-\\u{2A6DF}]/u],  // Special Characters, CJK Unified Ideographs, CJK Unified Ideographs Extension B\n\t\t\t['N', /[0-9０-９]/u],\n\t\t\t['V', /\\s/u],\n\t\t];\n\t\t\n\t\tfunction createCharTypeArray(str) {\n\t\t\tconst ts = [];\n\t\t\tfor (const c of str) {\n\t\t\t\tts.push(getCharType(c));\n\t\t\t}\n\t\t\treturn ts;\n\t\t}\n\t\t\n\t\tfunction getCharType(c) {\n\t\t\tfor (const [t, p] of CHAR_PATTERNS) {\n\t\t\t\tif (p.test(c)) return t;\n\t\t\t}\n\t\t\treturn 'O';\n\t\t}\n\t\t\n\t\t\n\t\t// -----------------------------------------------------------------------------\n\t\t\n\t\t\n\t\tconst PAIRS = {\n\t\t\t'*S': -1, 'S*': 2,\n\t\t\t'*E': 2,\n\t\t\t'*T': 99, 'T*': -99,\n\t\t\t'*V': -1, 'V*': -1,\n\t\t\t'II': 1, 'KK': 1, 'HH': 1,  'NN': 1, 'OO': 1, 'TT': 1,\n\t\t\t'HI': 1,\n\t\t\t'NH': 2, 'NK': 1, 'NI': 1,\n\t\t\t'ON': 1, 'NO': 1,\n\t\t};\n\t\t\n\t\tfunction weightByCharTypes(ts, ws) {\n\t\t\tfor (let i = 1; i < ts.length; i += 1) {\n\t\t\t\tconst t0 = ts[i - 1];\n\t\t\t\tconst t1 = ts[i];\n\t\t\t\tws[i] += (PAIRS[t0 + t1] ?? 0) + (PAIRS['*' + t1] ?? 0) + (PAIRS[t0 + '*'] ?? 0);\n\t\t\t}\n\t\t}\n\t\t\n\t\t\n\t\t// -----------------------------------------------------------------------------\n\t\t\n\t\t\n\t\tfunction divideByPhrases(strA, ws, phrases) {\n\t\t\tfor (const ph of phrases) {\n\t\t\t\tconst phA = [...ph];\n\t\t\t\tconst phL = phA.length;\n\t\t\n\t\t\t\tfor (let bgn = 0;;) {\n\t\t\t\t\tconst idx0 = indexOfArray(strA, phA, bgn);\n\t\t\t\t\tif (idx0 === -1) break;\n\t\t\t\t\tconst idx1 = idx0 + phL;\n\t\t\n\t\t\t\t\tws[idx0] -= phL;\n\t\t\t\t\tfor (let i = 1; i < phL; i += 1) ws[idx0 + i] += phL;\n\t\t\t\t\tbgn = idx1;\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t\t\n\t\tfunction divideByCombinedPhrases(strA, ws, phrases, al) {\n\t\t\tfor (const ph of phrases) {\n\t\t\t\tconst phA = [...ph];\n\t\t\t\tconst phL = phA.length;\n\t\t\n\t\t\t\tfor (let bgn = 0;;) {\n\t\t\t\t\tconst idx0 = indexOfArray(strA, phA, bgn);\n\t\t\t\t\tif (idx0 === -1) break;\n\t\t\t\t\tconst idx1 = idx0 + phL;\n\t\t\n\t\t\t\t\tws[idx0 + al] -= phL - al;\n\t\t\t\t\tfor (let i = 1; i < phL - al; i += 1) ws[idx0 + al + i] += phL - al;\n\t\t\t\t\tbgn = idx1;\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t\t\n\t\tfunction concatByPhrases(strA, ws, phrases) {\n\t\t\tfor (const ph of phrases) {\n\t\t\t\tconst phA = [...ph];\n\t\t\t\tconst phL = phA.length;\n\t\t\n\t\t\t\tfor (let bgn = 0; ;) {\n\t\t\t\t\tconst idx0 = indexOfArray(strA, phA, bgn);\n\t\t\t\t\tif (idx0 === -1) break;\n\t\t\t\t\tconst idx1 = idx0 + phL;\n\t\t\n\t\t\t\t\tws[idx0] += phL;\n\t\t\t\t\tfor (let i = 1; i < phL; i += 1) ws[idx0 + i] += phL;\n\t\t\t\t\tbgn = idx1;\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t\t\n\t\tfunction weightByPhrases(strA, ws, phrases, factor, offset = 0) {\n\t\t\tfor (const ph of phrases) {\n\t\t\t\tconst phA = [...ph];\n\t\t\t\tconst phL = phA.length;\n\t\t\n\t\t\t\tfor (let bgn = 0;;) {\n\t\t\t\t\tconst idx0 = indexOfArray(strA, phA, bgn);\n\t\t\t\t\tif (idx0 === -1) break;\n\t\t\t\t\tconst idx1 = idx0 + phL;\n\t\t\n\t\t\t\t\tws[idx0 + offset] += (phL - offset) * factor;\n\t\t\t\t\tfor (let i = 1; i < phL - offset; i += 1) {\n\t\t\t\t\t\tws[idx0 + offset + i] += (phL - offset);\n\t\t\t\t\t}\n\t\t\t\t\tbgn = idx1;\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t\t\n\t\tfunction weightByPhraseAndType(strA, ts, ws, phrases, prevCts, nextCts, prevW, nextW) {\n\t\t\tconst tsL = ts.length;\n\t\t\n\t\t\tfor (const ph of phrases) {\n\t\t\t\tconst phA = [...ph];\n\t\t\t\tconst phL = phA.length;\n\t\t\n\t\t\t\tfor (let bgn = 0; ;) {\n\t\t\t\t\tconst idx0 = indexOfArray(strA, phA, bgn);\n\t\t\t\t\tif (idx0 === -1) break;\n\t\t\t\t\tconst idx1 = idx0 + phL;\n\t\t\n\t\t\t\t\tif (\n\t\t\t\t\t\t(idx0 === 0   || (idx0 !== 0 && prevCts.includes(ts[idx0 - 1]))) &&\n\t\t\t\t\t\t(idx1 === tsL || (idx1 < tsL && nextCts.includes(ts[idx1])))\n\t\t\t\t\t) {\n\t\t\t\t\t\tws[idx0] += prevW;\n\t\t\t\t\t\tif (idx1 < ws.length) ws[idx1] += nextW;\n\t\t\t\t\t\tfor (let i = 1; i < phL; i += 1) ws[idx0 + i] += phL;\n\t\t\t\t\t}\n\t\t\t\t\tbgn = idx1;\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t\t\n\t\tfunction indexOfArray(array, searchElement, fromIndex = 0) {\n\t\t\tif (array === null || array === undefined) {\n\t\t\t\treturn -1;\n\t\t\t}\n\t\t\tif (array.length === 0) {\n\t\t\t\treturn -1;\n\t\t\t}\n\t\t\tfor (let i = fromIndex; i < array.length - searchElement.length + 1; i += 1) {\n\t\t\t\tlet match = true;\n\t\t\n\t\t\t\tfor (let j = 0; j < searchElement.length; j += 1) {\n\t\t\t\t\tif (array[i + j] !== searchElement[j]) {\n\t\t\t\t\t\tmatch = false;\n\t\t\t\t\t\tbreak;\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t\tif (match) {\n\t\t\t\t\treturn i;\n\t\t\t\t}\n\t\t\t}\n\t\t\treturn -1;\n\t\t}\n\t\t\n\t\t\n\t\t// -----------------------------------------------------------------------------\n\t\t\n\t\t\n\t\tfunction createFragment(str, ts, ws, opts) {\n\t\t\tconst df = document.createDocumentFragment();\n\t\t\tlet temp = '';\n\t\t\tlet bgn  = 0;\n\t\t\n\t\t\tlet idx = 0;\n\t\t\tfor (const c of str) {\n\t\t\t\tif (ws[idx] <= 0) {\n\t\t\t\t\tconst isOrig = isOriginalCharPhrase(ts, bgn, idx);\n\t\t\t\t\tappendPhrase(df, temp, isOrig, opts.styleSegment);\n\t\t\t\t\ttemp = '';\n\t\t\t\t\tbgn  = idx;\n\t\t\t\t}\n\t\t\t\ttemp += c;\n\t\t\t\tidx  += 1;\n\t\t\t}\n\t\t\tif (temp.length) {\n\t\t\t\tconst isOrig = isOriginalCharPhrase(ts, bgn, ts.length);\n\t\t\t\tappendPhrase(df, temp, isOrig, opts.styleSegment);\n\t\t\t}\n\t\t\treturn df;\n\t\t}\n\t\t\n\t\tfunction appendPhrase(df, str, isOrig, style) {\n\t\t\tif (isOrig) {\n\t\t\t\tdf.appendChild(document.createTextNode(str));\n\t\t\t} else {\n\t\t\t\tconst e = document.createElement('span');\n\t\t\t\te.appendChild(document.createTextNode(str));\n\t\t\t\tif (style.length) setClass(e, style);\n\t\t\t\tdf.appendChild(e);\n\t\t\t}\n\t\t}\n\t\t\n\t\tfunction isOriginalCharPhrase(ts, bgn, end) {\n\t\t\tfor (let i = bgn; i < end; i += 1) {\n\t\t\t\tconst t = ts[i];\n\t\t\t\tif (!CLS_ORIG.includes(t)) {\n\t\t\t\t\treturn false;\n\t\t\t\t}\n\t\t\t}\n\t\t\treturn true;\n\t\t}\n\t\t\n\t\tNS.applySegmenter         = apply;\n\t\tNS.applySegmenterToString = applyToString;\n\t}\n\t/**\n\t * Common Functions\n\t *\n\t * @author Takuto Yanagida\n\t * @version 2021-11-03\n\t */\n\t\n\tfunction removeHeadWhiteSpaces(str) {\n\t\tconst mzs = str.match(/^[\\n\\r\\t ]*(\\u3000*)/);\n\t\tconst zs = (mzs && 1 < mzs.length) ? mzs[1] : '';\n\t\treturn zs + str.replace(/^\\s+/g, '');  // Trim left\n\t}\n\t\n\tfunction removeTailWhiteSpaces(str) {\n\t\treturn str.replace(/\\s+$/g, '');  // Trim right\n\t}\n\t\n\tfunction removeWhiteSpacesBetweenZenChars(str) {\n\t\t// White space character class excluding \\u3000\n\t\t// [ \\f\\n\\r\\t\\v​\\u00a0​\\u180e\\u2000​-\\u200a​\\u2028\\u2029\\u202f\\u205f​\\ufeff]\n\t\treturn str.replace(/([^\\x01-\\x7E\\xA1-\\xDF]+)([\\t\\n]+|[ \\f\\n\\r\\t\\v\\u00a0\\u180e\\u2000-\\u200a\\u2028\\u2029\\u202f\\u205f\\ufeff]{2})([^\\x01-\\x7E\\xA1-\\xDF]+)/g, (match, g1, d, g2) => g1 + g2);\n\t}\n\t\n\n})(window['NACSS']['ja']);\n"]}