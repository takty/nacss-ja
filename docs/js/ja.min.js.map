{"version":3,"sources":["ja.js"],"names":["window","NS","initialize","ts","opts","length","Object","assign","styleKerning","styleDisabled","doAssignAttribute","doDisableOnSelecting","t","kernElement","dict","f","removeKerning","removeEventListener","addEventListener","elm","s","Array","from","getElementsByTagName","hasClass","df","document","createDocumentFragment","c","childNodes","appendChild","parentNode","replaceChild","apply","str","ks","getKerning","createFragment","nodeType","kernTextNode","tn","isHead","isTail","isEnd","textContent","mzs","match","replace","removeHeadWhiteSpaces","removeTailWhiteSpaces","removeWhiteSpacesBetweenZenChars","nt","nextSibling","getComputedStyle","display","innerText","parentNext","includes","p","HTMLElement","pd","isSiblingBlock","pp","n","greedy","isPreviousBlockGreedy","previousSibling","isBlock","tagName","trim","nextNodeText","assignAttr","strArray","ret","concat","l","i","c0","c1","a","has","push","k","Number","isInteger","createTextNode","slice","join","createElement","setClass","style","Set","addPairs","cs0","cs1","add","addSolos","head","h","jaKerning","jaApplyKerning","sortProperNouns","styleSegment","properNouns","segmentElement","removeSegment","sty","className","ws","getSegment","pns","map","e","sort","b","segmentTextNode","IW","split","AW","AI1","PRE_KANJI","PRE_NUM","createCharTypeArray","fill","weightByCharTypes","strA","weightByPhrases","weightByPhraseAndType","CLS_ALL","CLS_WO_KANJI","CLS_ORIG","CHAR_PATTERNS","getCharType","test","PAIRS","II","KK","HH","NN","OO","TT","HI","NH","NK","NI","ON","NO","t0","t1","phrases","factor","offset","ph","phA","phL","bgn","idx0","indexOfArray","idx1","prevCts","nextCts","prevW","nextW","tsL","array","searchElement","fromIndex","j","temp","idx","appendPhrase","isOriginalCharPhrase","isOrig","end","jaSegmenter","jaApplySegmenter","tar","cls","key","substr","startsWith","undefined","dataset","classList","contains","enabled","val","remove","g1","d","g2"],"mappings":"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","file":"ja.min.js","sourcesContent":["/**\n *\n * Japanese Text\n *\n * @author Takuto Yanagida\n * @version 2021-12-06\n *\n */\n\n\n'use strict';\n\nwindow['NACSS'] = window['NACSS'] || {};\n\n\n(function (NS) {\n\n\t{\n\t\t/**\n\t\t *\n\t\t * Kerning\n\t\t *\n\t\t * @author Takuto Yanagida\n\t\t * @version 2021-12-06\n\t\t *\n\t\t */\n\t\t\n\t\t\n\t\tfunction initialize(ts, opts = {}) {\n\t\t\tif (ts.length === 0) return;\n\t\t\n\t\t\topts = Object.assign({\n\t\t\t\tstyleKerning        : ':ncKern',\n\t\t\t\tstyleDisabled       : ':ncNoKerning',\n\t\t\t\tdoAssignAttribute   : true,\n\t\t\t\tdoDisableOnSelecting: true,\n\t\t\t}, opts);\n\t\t\n\t\t\tfor (const t of ts) {\n\t\t\t\tkernElement(t, dict, opts);\n\t\t\t\tif (opts['doAssignAttribute'] && opts['doDisableOnSelecting']) {\n\t\t\t\t\tconst f = () => {\n\t\t\t\t\t\tremoveKerning(t, opts);\n\t\t\t\t\t\tt.removeEventListener('selectstart', f);\n\t\t\t\t\t};\n\t\t\t\t\tt.addEventListener('selectstart', f);\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t\t\n\t\tfunction removeKerning(elm, opts) {\n\t\t\tfor (const s of Array.from(elm.getElementsByTagName('span'))) {\n\t\t\t\tif (hasClass(s, opts.styleKerning)) {\n\t\t\t\t\tconst df = document.createDocumentFragment();\n\t\t\t\t\tfor (const c of Array.from(s.childNodes)) {\n\t\t\t\t\t\tdf.appendChild(c);\n\t\t\t\t\t}\n\t\t\t\t\ts.parentNode.replaceChild(df, s);\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t\t\n\t\tfunction apply(str, opts = {}) {\n\t\t\topts = Object.assign({\n\t\t\t\tstyleKerning     : ':ncKern',\n\t\t\t\tstyleDisabled    : ':ncNoKerning',\n\t\t\t\tdoAssignAttribute: true,\n\t\t\t}, opts);\n\t\t\n\t\t\tconst ks = getKerning(str, dict, false, opts.doAssignAttribute);\n\t\t\tif (ks.length) {\n\t\t\t\treturn createFragment(str, ks, opts);\n\t\t\t}\n\t\t\treturn null;\n\t\t}\n\t\t\n\t\t\n\t\t// -----------------------------------------------------------------------------\n\t\t\n\t\t\n\t\tfunction kernElement(elm, dict, opts) {\n\t\t\tfor (const c of Array.from(elm.childNodes)) {\n\t\t\t\tif (c.nodeType === 1) {  // ELEMENT_NODE\n\t\t\t\t\tif (!hasClass(c, opts.styleDisabled)) kernElement(c, dict, opts);\n\t\t\t\t} else if (c.nodeType === 3) {  // TEXT_NODE\n\t\t\t\t\tkernTextNode(c, dict, opts);\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t\t\n\t\tfunction kernTextNode(tn, dict, opts) {\n\t\t\tconst [isHead, isTail] = isEnd(tn);\n\t\t\n\t\t\tlet str = tn.textContent;\n\t\t\tif (isHead) str = removeHeadWhiteSpaces(str);\n\t\t\tif (isTail) str = removeTailWhiteSpaces(str);\n\t\t\tstr = removeWhiteSpacesBetweenZenChars(str);\n\t\t\n\t\t\tlet nt = '';\n\t\t\tif (tn.nextSibling && tn.nextSibling.nodeType === 1 && getComputedStyle(tn.nextSibling).display === 'inline') {\n\t\t\t\tnt = tn.nextSibling.innerText;\n\t\t\t}\n\t\t\tif (!tn.nextSibling && tn.parentNode.nextSibling) {\n\t\t\t\tconst parentNext = tn.parentNode.nextSibling;\n\t\t\t\tif (parentNext.nodeType === 1) {  // ELEMENT_NODE\n\t\t\t\t\tconst pnd = getComputedStyle(parentNext).display;\n\t\t\t\t\tif (pnd.includes('inline')) {\n\t\t\t\t\t\tnt = parentNext.innerText;\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t\tif (parentNext.nodeType === 3) {  // TEXT_NODE\n\t\t\t\t\tnt = parentNext.textContent;\n\t\t\t\t}\n\t\t\t}\n\t\t\n\t\t\tconst ks = getKerning(str, dict, isHead, nt, opts.doAssignAttribute);\n\t\t\tif (ks.length) {\n\t\t\t\tconst f = createFragment(str, ks, opts);\n\t\t\t\ttn.parentNode.replaceChild(f, tn);\n\t\t\t}\n\t\t}\n\t\t\n\t\tfunction isEnd(tn) {\n\t\t\tconst p = tn.parentNode;\n\t\t\tif (!(p instanceof HTMLElement)) return [false, false];\n\t\t\tconst pd = getComputedStyle(p).display;\n\t\t\tif (!pd.includes('inline')) {  // Block\n\t\t\t\treturn isSiblingBlock(tn);\n\t\t\t}\n\t\t\tif (pd === 'inline-block') {  // Inline block\n\t\t\t\tif (p.childNodes.length !== 1) {  // The parent has multiple nodes.\n\t\t\t\t\treturn isSiblingBlock(tn);\n\t\t\t\t}\n\t\t\t\tconst pp = p.parentNode;\n\t\t\t\tif (pp) {\n\t\t\t\t\tconst ppd = getComputedStyle(pp).display;\n\t\t\t\t\tif (!ppd.includes('inline')) {\n\t\t\t\t\t\treturn isSiblingBlock(p, true);\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\t\t\treturn [false, false];  // Not inline block\n\t\t}\n\t\t\n\t\tfunction isSiblingBlock(n, greedy = false) {\n\t\t\treturn [greedy ? isPreviousBlockGreedy(n.previousSibling) : isBlock(n.previousSibling), isBlock(n.nextSibling)];\n\t\t}\n\t\t\n\t\tfunction isBlock(n) {\n\t\t\tif (n === null) return true;\n\t\t\tif (!(n instanceof HTMLElement)) return false;\n\t\t\tif (n.tagName === 'BR') return true;\n\t\t\treturn !getComputedStyle(n).display.includes('inline');\n\t\t}\n\t\t\n\t\tfunction isPreviousBlockGreedy(n) {\n\t\t\twhile (true) {\n\t\t\t\tif (n === null) return true;\n\t\t\t\tif (n.nodeType === 1) {\n\t\t\t\t\tif (n.tagName === 'BR') return true;\n\t\t\t\t\treturn !getComputedStyle(n).display.includes('inline');\n\t\t\t\t}\n\t\t\t\tif (n.nodeType === 3) {\n\t\t\t\t\tif (!n.textContent.trim()) return true;\n\t\t\t\t}\n\t\t\t\tn = n.previousSibling;\n\t\t\t}\n\t\t}\n\t\t\n\t\t\n\t\t// -----------------------------------------------------------------------------\n\t\t\n\t\t\n\t\tfunction getKerning(str, dict, isHead, nextNodeText, assignAttr) {\n\t\t\tlet strArray = Array.from(str);\n\t\t\tconst ret = [];\n\t\t\n\t\t\tif (nextNodeText.length) {\n\t\t\t\tstrArray = strArray.concat(Array.from(nextNodeText));\n\t\t\t}\n\t\t\tlet l = 0;\n\t\t\n\t\t\tfor (let i = 0; i < strArray.length; i += 1) {\n\t\t\t\tconst c0 = strArray[i];\n\t\t\t\tconst c1 = strArray[i + 1];\n\t\t\n\t\t\t\tlet a = '';\n\t\t\t\tif (c0 !== '' && c1 !== '' && dict.has(c0 + c1)) {\n\t\t\t\t\ta = assignAttr ? 's' : 'letter-spacing:-0.4em;';\n\t\t\t\t}\n\t\t\t\tif (i === 0 && isHead && c0 !== '' && dict.has(c0)) {\n\t\t\t\t\ta += assignAttr ? 'h' : 'margin-left:-0.4em';\n\t\t\t\t}\n\t\t\t\tif (a.length) {\n\t\t\t\t\tif (l) {\n\t\t\t\t\t\tret.push(l);\n\t\t\t\t\t\tl = 0;\n\t\t\t\t\t}\n\t\t\t\t\tret.push(a);\n\t\t\t\t} else {\n\t\t\t\t\tl += 1;\n\t\t\t\t}\n\t\t\t}\n\t\t\tif (ret.length && l) ret.push(l);\n\t\t\treturn ret;\n\t\t}\n\t\t\n\t\tfunction createFragment(str, ks, opts) {\n\t\t\tconst strArray = Array.from(str);\n\t\t\tconst f = document.createDocumentFragment();\n\t\t\tlet i = 0;\n\t\t\tfor (const k of ks) {\n\t\t\t\tif (Number.isInteger(k)) {\n\t\t\t\t\tconst n = document.createTextNode(strArray.slice(i, i + k).join(''));\n\t\t\t\t\tf.appendChild(n);\n\t\t\t\t\ti += k;\n\t\t\t\t} else {\n\t\t\t\t\tconst n = document.createElement('span');\n\t\t\t\t\tn.appendChild(document.createTextNode(strArray.slice(i, i + 1).join('')));\n\t\t\t\t\tif (k.length <= 2) {\n\t\t\t\t\t\tsetClass(n, opts.styleKerning, true, k);\n\t\t\t\t\t} else {\n\t\t\t\t\t\tn.style = k;\n\t\t\t\t\t}\n\t\t\t\t\tf.appendChild(n);\n\t\t\t\t\ti += 1;\n\t\t\t\t}\n\t\t\t}\n\t\t\treturn f;\n\t\t}\n\t\t\n\t\t\n\t\t// -----------------------------------------------------------------------------\n\t\t\n\t\t\n\t\tconst dict = new Set();\n\t\t{\n\t\t\taddPairs(dict, '、，。．・｜：　', '「『（［｛〈《【〔');\n\t\t\taddPairs(dict, '」』）］｝〉》】〕', '、，。．・｜：,.');\n\t\t\taddPairs(dict, '」』）］｝〉》】〕', '「『（［｛〈《【〔');\n\t\t\taddPairs(dict, '「『（［｛〈《【〔', '「『（［｛〈《【〔');\n\t\t\taddPairs(dict, '」』）］｝〉》】〕', '」』）］｝〉》】〕');\n\t\t\taddSolos(dict, '「『（［｛〈《【〔');\n\t\t\n\t\t\tfunction addPairs(dict, cs0, cs1) {\n\t\t\t\tfor (const c0 of cs0) {\n\t\t\t\t\tfor (const c1 of cs1) {\n\t\t\t\t\t\tdict.add(c0 + c1);\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\t\t\n\t\t\tfunction addSolos(dict, head) {\n\t\t\t\tfor (const h of head) {\n\t\t\t\t\tdict.add(h);\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t\t\n\t\tNS.jaKerning      = initialize;\n\t\tNS.jaApplyKerning = apply;\n\t}\n\n\t{\n\t\t/**\n\t\t *\n\t\t * Segmenter\n\t\t *\n\t\t * @author Takuto Yanagida\n\t\t * @version 2021-12-06\n\t\t *\n\t\t */\n\t\t\n\t\t\n\t\tfunction initialize(ts, opts = {}) {\n\t\t\tif (ts.length === 0) return;\n\t\t\n\t\t\topts = Object.assign({\n\t\t\t\tstyleSegment        : '',\n\t\t\t\tstyleDisabled       : ':ncNoSegmentation',\n\t\t\t\tdoDisableOnSelecting: true,\n\t\t\t\tproperNouns         : [],\n\t\t\t}, opts);\n\t\t\tsortProperNouns(opts);\n\t\t\n\t\t\tfor (const t of ts) {\n\t\t\t\tsegmentElement(t, opts);\n\t\t\t\tif (opts['doDisableOnSelecting']) {\n\t\t\t\t\tconst f = () => {\n\t\t\t\t\t\tremoveSegment(t, opts);\n\t\t\t\t\t\tt.removeEventListener('selectstart', f);\n\t\t\t\t\t};\n\t\t\t\t\tt.addEventListener('selectstart', f);\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t\t\n\t\tfunction removeSegment(elm, opts) {\n\t\t\tconst sty = opts.styleSegment;\n\t\t\tfor (const s of Array.from(elm.getElementsByTagName('span'))) {\n\t\t\t\tif ((sty.length === 0 && s.className === '') || hasClass(s, sty)) {\n\t\t\t\t\tconst df = document.createDocumentFragment();\n\t\t\t\t\tfor (const c of Array.from(s.childNodes)) {\n\t\t\t\t\t\tdf.appendChild(c);\n\t\t\t\t\t}\n\t\t\t\t\ts.parentNode.replaceChild(df, s);\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t\t\n\t\tfunction apply(str, opts = {}) {\n\t\t\topts = Object.assign({\n\t\t\t\tstyleSegment : '',\n\t\t\t\tstyleDisabled: ':ncNoSegmentation',\n\t\t\t\tproperNouns  : [],\n\t\t\t}, opts);\n\t\t\tsortProperNouns(opts);\n\t\t\n\t\t\tconst [ts, ws] = getSegment(str, opts.properNouns);\n\t\t\treturn createFragment(str, ts, ws, opts);\n\t\t}\n\t\t\n\t\tfunction sortProperNouns(opts) {\n\t\t\tconst pns = opts['properNouns'].map(e => Array.from(e));\n\t\t\tpns.sort((a, b) => {\n\t\t\t\treturn b.length - a.length;\n\t\t\t});\n\t\t\topts['properNouns'] = pns;\n\t\t}\n\t\t\n\t\t\n\t\t// -------------------------------------------------------------------------\n\t\t\n\t\t\n\t\tfunction segmentElement(elm, opts) {\n\t\t\tfor (const c of Array.from(elm.childNodes)) {\n\t\t\t\tif (c.nodeType === 1) {  // ELEMENT_NODE\n\t\t\t\t\tif (!hasClass(c, opts.styleDisabled)) segmentElement(c, opts);\n\t\t\t\t} else if (c.nodeType === 3) {  // TEXT_NODE\n\t\t\t\t\tsegmentTextNode(c, opts);\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t\t\n\t\tfunction segmentTextNode(tn, opts) {\n\t\t\tlet str = tn.textContent;\n\t\t\tstr = removeWhiteSpacesBetweenZenChars(str);\n\t\t\n\t\t\tconst [ts, ws] = getSegment(str, opts.properNouns);\n\t\t\tconst f = createFragment(str, ts, ws, opts);\n\t\t\ttn.parentNode.replaceChild(f, tn);\n\t\t}\n\t\t\n\t\t\n\t\t// -----------------------------------------------------------------------------\n\t\t\n\t\t\n\t\tconst IW = 'そうはいうものの,そればかりでなく,ありとあらゆる,いずれにしても,かけがえのない,そうしてみると,そうすることで,そうでないなら,そうではあるが,それにくわえて,それはさておき,どっちにしても,とはいうものの,なぜかというと,にもかかわらず,いいかえると,いずれにしろ,いずれにせよ,いってみれば,おもいきった,しかしながら,じつのところ,じつはいうと,そうしないと,そうではなく,そのためには,それどころか,それにしても,それによって,そればかりか,それはそうと,どちらにせよ,どっちにせよ,いろいろな,このように,さまざまな,さもないと,したがって,そういえば,そうしたら,そうすると,そうすれば,そうなると,そうなれば,そのかわり,それなのに,それゆえに,たくまざる,だとしたら,だとすると,だとすれば,ではあるが,というのは,というのも,というより,なぜならば,やすやすと,ようするに,ああいう,ああした,あたかも,あらゆる,あるいは,いかなる,いつかは,いっぱい,いろんな,いわゆる,おおきな,おかしな,おそらく,おなじく,おまけに,かえって,かくして,かわりに,くわえて,ぐんぐん,けれども,こういう,こうして,このため,しかるに,しばらく,すなわち,そういう,そうした,そのうえ,そのくせ,そのため,そもそも,それから,それから,それでは,それでも,それとも,それなら,それには,たいした,たいそう,たくさん,だけども,たとえば,たやすく,ちいさな,ちなみに,というか,どういう,とうてい,ときどき,ところが,どころか,ところで,となると,となれば,とにかく,とはいえ,ともあれ,とりわけ,ないしは,なかでも,なぜなら,なぜなら,なだたる,なにしろ,ならびに,はじめに,はずべき,はなはだ,ひいては,ひょんな,ふとした,ほかには,ほかにも,めっきり,もしくは,もっとも,あまり,あらぬ,ありし,あんな,いただ,いつか,いつも,いわば,および,かかる,かなり,きたる,きっと,けれど,ことに,こんな,さらに,しかし,しかも,じつは,じゃあ,すぐに,すぐに,すると,そこで,そして,そっと,それで,それに,そんな,だから,だけど,ただし,だって,たまに,つぎに,つまり,ですが,とある,どうか,ときに,とくに,とても,とんだ,どんな,なにせ,なのに,ならば,ほんの,まさか,または,むこう,むしろ,もっと,もっと,もっと,ものの,やはり,ゆえに,ようは,よって,ああ,あの,ある,かつ,かの,けど,こう,この,さて,さる,そう,その,だが,ただ,では,でも,どう,どの,なお,なぜ,のに,また,もし,よく,わが'.split(',');\n\t\tconst AW = 'けれども,ところで,において,について,かしら,がてら,くらい,ぐらい,けれど,ってば,ながら,などの,なんぞ,ばかり,ものか,ものの,かい,から,かり,きり,こそ,さえ,しか,ずつ,だけ,だの,たり,つつ,では,ても,でも,とも,なぞ,など,なり,にて,には,ので,のに,のみ,ほど,まで,まま,もん,やら,より,か,が,さ,し,ぜ,ぞ,て,で,と,な,に,ね,の,は,ば,へ,も,や,よ,わ,を'.split(',');\n\t\t\n\t\tconst AI1       = 'がおこな,のような,があり,がおき,ができ,がでて'.split(',');\n\t\tconst PRE_KANJI = 'お,ご'.split(',');\n\t\tconst PRE_NUM   = '第,約'.split(',');\n\t\t\n\t\tfunction getSegment(str, properNouns) {\n\t\t\tconst ts = createCharTypeArray(str);\n\t\t\tconst ws = Array(ts.length).fill(0);\n\t\t\n\t\t\tweightByCharTypes(ts, ws);\n\t\t\n\t\t\tconst strA = Array.from(str);\n\t\t\tif (properNouns.length) weightByPhrases(strA, ws, properNouns, -1);  // Divide\n\t\t\tweightByPhrases(strA, ws, IW, -1);  // Divide\n\t\t\tweightByPhrases(strA, ws, AW, 1);  // Concat\n\t\t\n\t\t\tweightByPhrases(strA, ws, AI1, -1, 1);  // Divide with offset\n\t\t\tweightByPhraseAndType(strA, ts, ws, PRE_KANJI, CLS_ALL,      'H', -1, 2);\n\t\t\tweightByPhraseAndType(strA, ts, ws, PRE_NUM,   CLS_WO_KANJI, 'N',  0, 2);\n\t\t\n\t\t\treturn [ts, ws];\n\t\t}\n\t\t\n\t\t\n\t\t// -----------------------------------------------------------------------------\n\t\t\n\t\t\n\t\tconst CLS_WO_KANJI = 'SETIKNVO';\n\t\tconst CLS_ALL      = 'SETIKHNVO';\n\t\tconst CLS_ORIG     = 'NVO';\n\t\t\n\t\tconst CHAR_PATTERNS = [\n\t\t\t['S', /[「『（［｛〈《【〔〖〘〚＜“]/u],\n\t\t\t['E', /[」』）］｝〉》】〕〗〙〛＞”]/u],\n\t\t\t['T', /[、，。．？！を：・]/u],\n\t\t\t['I', /[ぁ-んゝ]/u],\n\t\t\t['K', /[ァ-ヴーｱ-ﾝﾞｰ]/u],\n\t\t\t['H', /[々〆ヵヶ]|[\\u4E00-\\u9FFF]|[\\u{20000}-\\u{2A6DF}]/u],  // Special Characters, CJK Unified Ideographs, CJK Unified Ideographs Extension B\n\t\t\t['N', /[0-9０-９]/u],\n\t\t\t['V', /\\s/u],\n\t\t];\n\t\t\n\t\tfunction createCharTypeArray(str) {\n\t\t\tconst ts = [];\n\t\t\tfor (const c of str) {\n\t\t\t\tts.push(getCharType(c));\n\t\t\t}\n\t\t\treturn ts;\n\t\t}\n\t\t\n\t\tfunction getCharType(c) {\n\t\t\tfor (const [t, p] of CHAR_PATTERNS) {\n\t\t\t\tif (p.test(c)) return t;\n\t\t\t}\n\t\t\treturn 'O';\n\t\t}\n\t\t\n\t\t\n\t\t// -----------------------------------------------------------------------------\n\t\t\n\t\t\n\t\tconst PAIRS = {\n\t\t\t'*S': -1, 'S*': 2,\n\t\t\t'*E': 2,\n\t\t\t'*T': 99, 'T*': -99,\n\t\t\t'*V': -1, 'V*': -1,\n\t\t\t'II': 1, 'KK': 1, 'HH': 1,  'NN': 1, 'OO': 1, 'TT': 1,\n\t\t\t'HI': 1,\n\t\t\t'NH': 2, 'NK': 1, 'NI': 1,\n\t\t\t'ON': 1, 'NO': 1,\n\t\t};\n\t\t\n\t\tfunction weightByCharTypes(ts, ws) {\n\t\t\tfor (let i = 1; i < ts.length; i += 1) {\n\t\t\t\tconst t0 = ts[i - 1];\n\t\t\t\tconst t1 = ts[i];\n\t\t\t\tws[i] += (PAIRS[t0 + t1] ?? 0) + (PAIRS['*' + t1] ?? 0) + (PAIRS[t0 + '*'] ?? 0);\n\t\t\t}\n\t\t}\n\t\t\n\t\t\n\t\t// -----------------------------------------------------------------------------\n\t\t\n\t\t\n\t\tfunction divideByPhrases(strA, ws, phrases) {\n\t\t\tfor (const ph of phrases) {\n\t\t\t\tconst phA = Array.from(ph);\n\t\t\t\tconst phL = phA.length;\n\t\t\n\t\t\t\tfor (let bgn = 0;;) {\n\t\t\t\t\tconst idx0 = indexOfArray(strA, phA, bgn);\n\t\t\t\t\tif (idx0 === -1) break;\n\t\t\t\t\tconst idx1 = idx0 + phL;\n\t\t\n\t\t\t\t\tws[idx0] -= phL;\n\t\t\t\t\tfor (let i = 1; i < phL; i += 1) ws[idx0 + i] += phL;\n\t\t\t\t\tbgn = idx1;\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t\t\n\t\tfunction divideByCombinedPhrases(strA, ws, phrases, al) {\n\t\t\tfor (const ph of phrases) {\n\t\t\t\tconst phA = Array.from(ph);\n\t\t\t\tconst phL = phA.length;\n\t\t\n\t\t\t\tfor (let bgn = 0;;) {\n\t\t\t\t\tconst idx0 = indexOfArray(strA, phA, bgn);\n\t\t\t\t\tif (idx0 === -1) break;\n\t\t\t\t\tconst idx1 = idx0 + phL;\n\t\t\n\t\t\t\t\tws[idx0 + al] -= phL - al;\n\t\t\t\t\tfor (let i = 1; i < phL - al; i += 1) ws[idx0 + al + i] += phL - al;\n\t\t\t\t\tbgn = idx1;\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t\t\n\t\tfunction concatByPhrases(strA, ws, phrases) {\n\t\t\tfor (const ph of phrases) {\n\t\t\t\tconst phA = Array.from(ph);\n\t\t\t\tconst phL = phA.length;\n\t\t\n\t\t\t\tfor (let bgn = 0; ;) {\n\t\t\t\t\tconst idx0 = indexOfArray(strA, phA, bgn);\n\t\t\t\t\tif (idx0 === -1) break;\n\t\t\t\t\tconst idx1 = idx0 + phL;\n\t\t\n\t\t\t\t\tws[idx0] += phL;\n\t\t\t\t\tfor (let i = 1; i < phL; i += 1) ws[idx0 + i] += phL;\n\t\t\t\t\tbgn = idx1;\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t\t\n\t\tfunction weightByPhrases(strA, ws, phrases, factor, offset = 0) {\n\t\t\tfor (const ph of phrases) {\n\t\t\t\tconst phA = Array.from(ph);\n\t\t\t\tconst phL = phA.length;\n\t\t\n\t\t\t\tfor (let bgn = 0;;) {\n\t\t\t\t\tconst idx0 = indexOfArray(strA, phA, bgn);\n\t\t\t\t\tif (idx0 === -1) break;\n\t\t\t\t\tconst idx1 = idx0 + phL;\n\t\t\n\t\t\t\t\tws[idx0 + offset] += (phL - offset) * factor;\n\t\t\t\t\tfor (let i = 1; i < phL - offset; i += 1) {\n\t\t\t\t\t\tws[idx0 + offset + i] += (phL - offset);\n\t\t\t\t\t}\n\t\t\t\t\tbgn = idx1;\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t\t\n\t\tfunction weightByPhraseAndType(strA, ts, ws, phrases, prevCts, nextCts, prevW, nextW) {\n\t\t\tconst tsL = ts.length;\n\t\t\n\t\t\tfor (const ph of phrases) {\n\t\t\t\tconst phA = Array.from(ph);\n\t\t\t\tconst phL = phA.length;\n\t\t\n\t\t\t\tfor (let bgn = 0; ;) {\n\t\t\t\t\tconst idx0 = indexOfArray(strA, phA, bgn);\n\t\t\t\t\tif (idx0 === -1) break;\n\t\t\t\t\tconst idx1 = idx0 + phL;\n\t\t\n\t\t\t\t\tif (\n\t\t\t\t\t\t(idx0 === 0   || (idx0 !== 0 && prevCts.includes(ts[idx0 - 1]))) &&\n\t\t\t\t\t\t(idx1 === tsL || (idx1 < tsL && nextCts.includes(ts[idx1])))\n\t\t\t\t\t) {\n\t\t\t\t\t\tws[idx0] += prevW;\n\t\t\t\t\t\tif (idx1 < ws.length) ws[idx1] += nextW;\n\t\t\t\t\t\tfor (let i = 1; i < phL; i += 1) ws[idx0 + i] += phL;\n\t\t\t\t\t}\n\t\t\t\t\tbgn = idx1;\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t\t\n\t\tfunction indexOfArray(array, searchElement, fromIndex = 0) {\n\t\t\tif (array === null || array === undefined) {\n\t\t\t\treturn -1;\n\t\t\t}\n\t\t\tif (array.length === 0) {\n\t\t\t\treturn 0;\n\t\t\t}\n\t\t\tfor (let i = fromIndex; i < array.length - searchElement.length + 1; i += 1) {\n\t\t\t\tlet match = true;\n\t\t\n\t\t\t\tfor (let j = 0; j < searchElement.length; j += 1) {\n\t\t\t\t\tif (array[i + j] !== searchElement[j]) {\n\t\t\t\t\t\tmatch = false;\n\t\t\t\t\t\tbreak;\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t\tif (match) {\n\t\t\t\t\treturn i;\n\t\t\t\t}\n\t\t\t}\n\t\t\treturn -1;\n\t\t}\n\t\t\n\t\t\n\t\t// -----------------------------------------------------------------------------\n\t\t\n\t\t\n\t\tfunction createFragment(str, ts, ws, opts) {\n\t\t\tconst df = document.createDocumentFragment();\n\t\t\tlet temp = '';\n\t\t\tlet bgn  = 0;\n\t\t\n\t\t\tlet idx = 0;\n\t\t\tfor (const c of str) {\n\t\t\t\tif (ws[idx] <= 0) {\n\t\t\t\t\tconst isOrig = isOriginalCharPhrase(ts, bgn, idx);\n\t\t\t\t\tappendPhrase(df, temp, isOrig, opts.styleSegment);\n\t\t\t\t\ttemp = '';\n\t\t\t\t\tbgn  = idx;\n\t\t\t\t}\n\t\t\t\ttemp += c;\n\t\t\t\tidx  += 1;\n\t\t\t}\n\t\t\tif (temp.length) {\n\t\t\t\tconst isOrig = isOriginalCharPhrase(ts, bgn, ts.length);\n\t\t\t\tappendPhrase(df, temp, isOrig, opts.styleSegment);\n\t\t\t}\n\t\t\treturn df;\n\t\t}\n\t\t\n\t\tfunction appendPhrase(df, str, isOrig, style) {\n\t\t\tif (isOrig) {\n\t\t\t\tdf.appendChild(document.createTextNode(str));\n\t\t\t} else {\n\t\t\t\tconst e = document.createElement('span');\n\t\t\t\te.appendChild(document.createTextNode(str));\n\t\t\t\tif (style.length) setClass(e, style);\n\t\t\t\tdf.appendChild(e);\n\t\t\t}\n\t\t}\n\t\t\n\t\tfunction isOriginalCharPhrase(ts, bgn, end) {\n\t\t\tfor (let i = bgn; i < end; i += 1) {\n\t\t\t\tconst t = ts[i];\n\t\t\t\tif (!CLS_ORIG.includes(t)) {\n\t\t\t\t\treturn false;\n\t\t\t\t}\n\t\t\t}\n\t\t\treturn true;\n\t\t}\n\t\t\n\t\tNS.jaSegmenter      = initialize;\n\t\tNS.jaApplySegmenter = apply;\n\t}\n\n\t/**\n\t *\n\t * Style Class Utilities\n\t *\n\t * @author Takuto Yanagida\n\t * @version 2021-11-11\n\t *\n\t */\n\t\n\t\n\tfunction hasClass(tar, cls) {\n\t\tconst key = cls.substr(1);\n\t\tif (cls.startsWith(':')) {\n\t\t\treturn tar.dataset[key] !== undefined;\n\t\t} else {\n\t\t\treturn tar.classList.contains(key);\n\t\t}\n\t}\n\t\n\tfunction setClass(tar, cls, enabled = true, val = '') {\n\t\tconst key = cls.substr(1);\n\t\tif (cls.startsWith(':')) {\n\t\t\tif (enabled) {\n\t\t\t\ttar.dataset[key] = val;\n\t\t\t} else {\n\t\t\t\tdelete tar.dataset[key];\n\t\t\t}\n\t\t} else {\n\t\t\tconst c = [key, val].join('-');\n\t\t\tif (enabled) {\n\t\t\t\ttar.classList.add(c);\n\t\t\t} else {\n\t\t\t\ttar.classList.remove(c);\n\t\t\t}\n\t\t}\n\t}\n\t\n\tfunction getSelector(cls) {\n\t\tif (cls.startsWith(':')) {\n\t\t\treturn `*[data-${cls.substr(1).replace(/([A-Z])/g, c => '-' + c.charAt(0).toLowerCase())}]`;\n\t\t} else {\n\t\t\treturn `*${cls}`;\n\t\t}\n\t}\n\t\n\t/**\n\t *\n\t * Common Functions\n\t *\n\t * @author Takuto Yanagida\n\t * @version 2021-11-03\n\t *\n\t */\n\t\n\t\n\tfunction removeHeadWhiteSpaces(str) {\n\t\tconst mzs = str.match(/^[\\n\\r\\t ]*(\\u3000*)/);\n\t\tconst zs = (mzs && 1 < mzs.length) ? mzs[1] : '';\n\t\treturn zs + str.replace(/^\\s+/g, '');  // Trim left\n\t}\n\t\n\tfunction removeTailWhiteSpaces(str) {\n\t\treturn str.replace(/\\s+$/g, '');  // Trim right\n\t}\n\t\n\tfunction removeWhiteSpacesBetweenZenChars(str) {\n\t\t// White space character class excluding \\u3000\n\t\t// [ \\f\\n\\r\\t\\v​\\u00a0​\\u180e\\u2000​-\\u200a​\\u2028\\u2029\\u202f\\u205f​\\ufeff]\n\t\treturn str.replace(/([^\\x01-\\x7E\\xA1-\\xDF]+)([\\t\\n]+|[ \\f\\n\\r\\t\\v\\u00a0\\u180e\\u2000-\\u200a\\u2028\\u2029\\u202f\\u205f\\ufeff]{2})([^\\x01-\\x7E\\xA1-\\xDF]+)/g, (match, g1, d, g2) => g1 + g2);\n\t}\n\t\n\n})(window['NACSS']);\n"]}